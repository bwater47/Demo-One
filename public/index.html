<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DoorDash Order Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .test-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }

        .test-info h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .test-info p {
            color: #666;
            margin: 5px 0;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .status.loading {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
        }

        .order-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.3rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
            min-width: 250px;
        }

        .order-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }

        .order-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .order-details {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
        }

        .order-details h3 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .order-details p {
            margin: 8px 0;
            color: #555;
        }

        .order-details strong {
            color: #333;
        }

        .hidden {
            display: none;
        }

        .api-url {
            background: #f1f3f4;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9rem;
            margin: 10px 0;
            word-break: break-all;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üöö DoorDash Test Order</h1>

        <div class="test-info">
            <h3>Test Restaurant: Pizza Palace</h3>
            <p><strong>Item:</strong> Margherita Pizza - $14.99</p>
            <p><strong>Cuisine:</strong> Italian</p>
            <p><strong>Delivery:</strong> 25-35 min, $2.99 fee</p>
        </div>

        <div class="api-url">
            <strong>API Endpoint:</strong> <span id="api-url-display"></span>
        </div>

        <div id="status" class="status hidden"></div>

        <button id="order-btn" class="order-button">üçï Order Test Pizza</button>

        <div id="order-details" class="order-details hidden">
            <h3>üìã Order Details</h3>
            <div id="order-info"></div>
        </div>
    </div>

    <script>
        const API_URL = 'https://mockdoordash.netlify.app/graphql';
        // For local testing, use: 'http://localhost:8888/graphql'
        // For production, use: 'https://your-app-name.netlify.app/graphql'

        // Display the API URL being used
        document.getElementById('api-url-display').textContent = API_URL;

        let currentOrder = null;

        // GraphQL mutations
        const CREATE_ORDER = `
            mutation CreateOrder($input: CreateOrderInput!) {
                createOrder(input: $input) {
                    id
                    totalAmount
                    status
                    externalDeliveryId
                    restaurant {
                        name
                    }
                }
            }
        `;

        const CREATE_DELIVERY = `
            mutation CreateDelivery($orderId: ID!, $input: CreateDeliveryInput!) {
                createDelivery(orderId: $orderId, input: $input) {
                    id
                    status
                    doordashDeliveryId
                    doordashStatus
                }
            }
        `;

        // Utility functions
        function showStatus(message, type = 'loading') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.classList.remove('hidden');
        }

        function hideStatus() {
            document.getElementById('status').classList.add('hidden');
        }

        async function graphqlRequest(query, variables = {}) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query,
                        variables
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (result.errors) {
                    throw new Error(result.errors[0].message);
                }

                return result.data;
            } catch (error) {
                console.error('GraphQL Error:', error);
                throw error;
            }
        }

        async function createTestOrder() {
            try {
                showStatus('Creating test order...');

                // Create order with Pizza Palace (restaurant ID 1) and Margherita Pizza (menu item ID 1)
                const orderInput = {
                    restaurantId: "1", // Pizza Palace from your sample data
                    items: [{
                        menuItemId: "1", // Margherita Pizza from your sample data
                        quantity: 1
                    }]
                };

                console.log('Creating order with input:', orderInput);
                const orderData = await graphqlRequest(CREATE_ORDER, { input: orderInput });
                currentOrder = orderData.createOrder;

                showStatus('Order created! Requesting delivery...');
                console.log('Order created:', currentOrder);

                // Create delivery
                const deliveryInput = {
                    pickupAddress: "123 Main St, City, State",
                    pickupBusinessName: "Pizza Palace",
                    pickupPhoneNumber: "555-0123",
                    pickupInstructions: "Please call when you arrive",
                    dropoffAddress: "456 Customer Ave, City, State 12345",
                    dropoffBusinessName: "Customer",
                    dropoffPhoneNumber: "555-0124",
                    dropoffInstructions: "Leave at door, ring bell"
                };

                console.log('Creating delivery with input:', deliveryInput);
                const deliveryData = await graphqlRequest(CREATE_DELIVERY, {
                    orderId: currentOrder.id,
                    input: deliveryInput
                });

                console.log('Delivery created:', deliveryData);
                showStatus('üéâ Test order and delivery created successfully!', 'success');
                showOrderDetails();

            } catch (error) {
                console.error('Full error:', error);
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        function showOrderDetails() {
            if (!currentOrder) return;

            const orderDetailsEl = document.getElementById('order-details');
            const orderInfoEl = document.getElementById('order-info');

            orderInfoEl.innerHTML = `
                <p><strong>Order ID:</strong> ${currentOrder.id}</p>
                <p><strong>Restaurant:</strong> ${currentOrder.restaurant.name}</p>
                <p><strong>Item:</strong> Margherita Pizza (1x)</p>
                <p><strong>Total:</strong> $${currentOrder.totalAmount}</p>
                <p><strong>Status:</strong> ${currentOrder.status}</p>
                <p><strong>External Delivery ID:</strong> ${currentOrder.externalDeliveryId}</p>
                <p style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 5px; color: #2e7d32;">
                    <strong>‚úÖ Success!</strong> This is a test order using the mock DoorDash API. 
                    In production, this would create a real delivery request.
                </p>
            `;

            orderDetailsEl.classList.remove('hidden');
        }

        // Event listeners
        document.getElementById('order-btn').addEventListener('click', createTestOrder);

        // Test API connection on page load
        window.addEventListener('load', () => {
            console.log('Page loaded, API URL:', API_URL);
            console.log('Ready to test order creation');
        });
    </script>
</body>

</html>